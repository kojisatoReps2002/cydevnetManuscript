【アプリの親子関係について】(2016/08/19)

さまざまな場面で用途の幅が広がっている kintone ですが、今回は業務への適用にあたり、ご相談をいただくことの多い、アプリ間のいわゆる「親子関係」についての考察を行いたいと思います。実装上のTipsというよりは、複数のアプリが必要となる業務において、各アプリ間の関係性を設計する際の考え方として、皆様の一助になれば幸いです。

「親子関係」というと、集合論理や家庭問題(!)など何やら面倒で複雑なイメージを持たれる方もいらっしゃるかもしれませんが、あまり固く考えずに、kintone 上で実装可能な以下2通りの関係をこの記事での「親子関係」として取り扱いさせていただきます。

1.kintone では「テーブルフィールド」を用いることにより、あるアプリの中に、関連する複数の情報を保存することが可能です。この時「テーブルフィールド」として設定された項目を「子」それ以外の項目を「親」と呼び、この2つの情報の関係性を「同居親子関係」※と呼ぶこととします。

[fig 1. (dn1608explanatory.pptx slide 1)]

2.kintone の「ルックアップフィールド」を用いて、あるアプリから別のアプリを参照したい場合、参照される方を「親アプリ」参照する方を「子アプリ」と呼び、この2つのアプリの関係性を「独立親子関係」※と呼ぶこととします。

※これらの呼び方は、あくまでも情報の親子関係性の説明の為に、便宜的にこの記事のみで使用しているもので、正式な呼び方ではございませんので、悪しからず。

上記の「親子関係」において、

- いずれも、1つの「親」に対して複数の「子」が存在することが可能です。

- 1.の「同居親子関係」の場合
    - 「親」の無い「子」は存在しません。
    - 「親」が消去されると「子」も消去されます。
    - 「親」の「子」が同時に他の「親」の「子」となることはできません。

- 2.の「独立親子関係」の場合
    - 「親」の無い「子」は原則として存在可能です。
    - 「子」の「親」へのルックアップフィールドが必須項目の場合は、その制約が有効な限り「親」の無い「子」の登録はできませんが、存在は可能です。
    - 「親」の消去が「子」の消去を、必ずしも意味しません。
    - 「親」の「子」が同時に他の「親」の「子」となることも可能です。
        - 必要な「親」の数のルックアップフィールドが必要となります。

こうしてみると、当然の事ながら「親子関係」の関係性がより強いのが「同居親子関係」であり、逆に独立志向の強い「子」を持つ「親」との関係が「独立親子関係」であるというのがイメージできるかと思います。

「同居親子関係」及び「独立親子関係」双方を実装している例として、アプリストアにある[商品見積書パック](https://kintone-apps.cybozu.co.jp/054-mitsumori.html)がございますので、これを元に具体的なそれぞれの作用を見ていきましょう。

[fig 2. (dn1608explanatory.pptx slide 2)]

このアプリでは「親」である「見積書」に「同居親子関係」の実装としてテーブルフィールドを利用し「見積明細」が実装されています。「見積書」のない「見積明細」は存在し得ないので、この関係性は妥当に見えます。正に同居している状態ですね。

kintone の実装上の機能として、テーブルフィールドに設定された数値項目は計算フィールドの計算対象となりますので、この場合であれば、その計算式に、[sum(小計)]とするだけで「子」の情報である「小計」項目の集計を行った「合計金額」として実装されています。

「合計金額」は「子」の情報を集計したものですが、この計算結果としての項目も「親」の情報として一覧に表示を行うことができ、かつ「子」情報として登録してある、明細内容の確認も一行づつではありますが[表示する]リンクを選択することにより、可能となっています。

これまでシステム開発経験のある方ほど「同居親子関係」にある、イメージ的にはやや篭もりがちな「子」の情報について、その合計値や、明細を一覧で確認するのは難しいと考えられるようで、よく問合せをいただくところですが、これらを標準機能で実現可能なところが、kintone の強力な機能のひとつと言えるかと思います。

[fig 3. (dn160802.png)

また、一覧で表示するのみならず、「子」の情報である見積明細の商品情報と、小計金額情報を元に、商品別売上構成をグラフに表示するなどの集計も簡単に行うことができます。fig 3.は2016年1月版より提供されたモバイルビューでのグラフ表示のスマートフォン参照画面になります。

[fig 4. (dn160803.png)

さて、次に「独立親子」の関係性を見てみましょう。見積明細は見積に対しては「同居親子」ですが、商品リストアプリに対しては「独立親子」という少々複雑な環境に育った子供のようです。まずはその個性、独立っぷりを見てみたいと思います。
















[不使用のテキスト]



・見積書の明細

おかげさまをもちまして、これまでkintoneの導入社数は順調に伸びており、まもなく、5,000社を越えようかという勢いで、これだけ多くのお客様にご利用頂いている事は嬉しい限りです。

とは言え、サービス提供を開始した2011年11月から今年で、ようやく5才になる kintone ではございますので、さらに幅広い業務用途でご利用頂くためにはまだまだ、成長を続けていかなくてはなりません。

予め[商品リスト]アプリに商品を登録しておくことにより、[見積書]アプリの明細を作成する際に、登録された商品を検索して自動的に商品に関する情報を反映することが可能で、とても便利です。

見積書の作成がこの[商品見積書パック]で完結するのであれば、これはこれで良いですね、で終わるわけですが、実際にご利用いただいている業務では

さて、ここまで見積書アプリにおける見積と明細の「同居親子関係」が kintone の標準機能であるテーブルフィールドにより実装されている様子を見てまいりましたが、この仲の良い(便利な)「同居親子」にも実は課題があります。



